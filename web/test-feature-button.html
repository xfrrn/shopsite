<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>特色产品按钮测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .lang-btn { margin-right: 10px; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; }
        .lang-btn.active { background: #007bff; color: white; }
        .lang-btn:not(.active) { background: #6c757d; color: white; }
        .product-card { border: 1px solid #eee; padding: 15px; border-radius: 8px; max-width: 300px; }
        .product-btn { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        #debug-info { background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>特色产品按钮多语言测试</h1>
    
    <div class="test-section">
        <h3>语言切换</h3>
        <button id="btn-zh" class="lang-btn active" onclick="switchLang('zh')">中文</button>
        <button id="btn-en" class="lang-btn" onclick="switchLang('en')">English</button>
        <p>当前语言: <span id="current-lang">中文</span></p>
    </div>
    
    <div class="test-section">
        <h3>翻译测试</h3>
        <div id="translation-results">
            <!-- 翻译结果将显示在这里 -->
        </div>
    </div>
    
    <div class="test-section">
        <h3>模拟产品卡片</h3>
        <div id="test-product-card">
            <!-- 测试产品卡片将显示在这里 -->
        </div>
    </div>
    
    <div class="test-section">
        <h3>调试信息</h3>
        <div id="debug-info">
            <!-- 调试信息将显示在这里 -->
        </div>
    </div>

    <!-- 引入脚本 -->
    <script src="js/i18n.js?v=20250915"></script>
    <script src="js/featured-products.js?v=20250915"></script>
    
    <script>
        function updateDebug(msg) {
            const debugDiv = document.getElementById('debug-info');
            const time = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<div>${time}: ${msg}</div>`;
            console.log('DEBUG:', msg);
        }
        
        function switchLang(lang) {
            updateDebug(`切换语言到: ${lang}`);
            
            // 更新按钮状态
            document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
            
            // 更新语言显示
            document.getElementById('current-lang').textContent = lang === 'zh' ? '中文' : 'English';
            
            // 切换i18n语言
            if (window.i18n) {
                window.i18n.switchLanguage(lang).then(() => {
                    updateDebug('语言切换完成');
                    showTranslations();
                    createTestProductCard();
                });
            } else {
                updateDebug('i18n对象不存在');
            }
        }
        
        function showTranslations() {
            const resultsDiv = document.getElementById('translation-results');
            if (window.i18n) {
                const currentLang = window.i18n.getCurrentLanguage();
                resultsDiv.innerHTML = `
                    <p><strong>当前语言:</strong> ${currentLang}</p>
                    <p><strong>btn.view_details:</strong> "${window.i18n.t('btn.view_details')}"</p>
                    <p><strong>btn.click_view_details:</strong> "${window.i18n.t('btn.click_view_details')}"</p>
                    <p><strong>featured.title:</strong> "${window.i18n.t('featured.title')}"</p>
                    <p><strong>featured.subtitle:</strong> "${window.i18n.t('featured.subtitle')}"</p>
                `;
                updateDebug(`翻译结果已更新 (${currentLang})`);
            } else {
                resultsDiv.innerHTML = '<p class="error">i18n对象不存在</p>';
            }
        }
        
        function createTestProductCard() {
            if (!window.FeaturedProducts) {
                updateDebug('FeaturedProducts类不存在');
                return;
            }
            
            try {
                const fp = new window.FeaturedProducts();
                
                // 模拟产品数据
                const testProduct = {
                    id: 999,
                    name: '测试产品',
                    name_en: 'Test Product',
                    description: '这是一个测试产品',
                    description_en: 'This is a test product',
                    price: 99.99,
                    image_url: 'https://via.placeholder.com/200x200?text=Test+Product'
                };
                
                // 生成产品卡片HTML
                const cardHtml = fp.renderSingleProductCard(testProduct, 1);
                document.getElementById('test-product-card').innerHTML = cardHtml;
                
                updateDebug('测试产品卡片已生成');
            } catch (e) {
                updateDebug('生成测试产品卡片失败: ' + e.message);
                console.error(e);
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateDebug('页面加载完成');
            
            setTimeout(() => {
                updateDebug('开始初始化测试');
                showTranslations();
                createTestProductCard();
            }, 500);
        });
        
        // 监听语言切换事件
        window.addEventListener('languageChanged', function(e) {
            updateDebug('收到语言切换事件: ' + e.detail.language);
        });
    </script>
</body>
</html>