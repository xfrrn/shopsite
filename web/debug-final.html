<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>按钮文本调试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; background: #f9f9f9; }
        .result { background: white; padding: 10px; border-left: 3px solid #007bff; margin: 10px 0; }
        .error { border-left-color: #dc3545; }
        button { margin: 5px; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <h1>特色产品按钮文本调试工具</h1>
    
    <div class="debug-section">
        <h3>步骤1: 检查脚本加载</h3>
        <button class="btn-primary" onclick="checkScripts()">检查脚本</button>
        <div id="script-check" class="result">点击按钮检查</div>
    </div>
    
    <div class="debug-section">
        <h3>步骤2: 测试翻译功能</h3>
        <button class="btn-primary" onclick="testTranslations()">测试翻译</button>
        <div id="translation-check" class="result">点击按钮测试</div>
    </div>
    
    <div class="debug-section">
        <h3>步骤3: 直接测试renderSingleProductCard</h3>
        <button class="btn-secondary" onclick="testCardRender('zh')">测试中文卡片</button>
        <button class="btn-secondary" onclick="testCardRender('en')">测试英文卡片</button>
        <div id="card-test" class="result">点击按钮测试</div>
    </div>

    <!-- 加载脚本，添加时间戳防止缓存 -->
    <script src="js/i18n.js?t=${Date.now()}"></script>
    <script src="js/featured-products.js?t=${Date.now()}"></script>
    
    <script>
        function checkScripts() {
            const resultDiv = document.getElementById('script-check');
            
            const i18nLoaded = typeof window.i18n !== 'undefined';
            const fpLoaded = typeof window.FeaturedProducts !== 'undefined';
            
            resultDiv.innerHTML = `
                <strong>脚本加载状态:</strong><br>
                • i18n.js 已加载: ${i18nLoaded ? '✅' : '❌'}<br>
                • featured-products.js 已加载: ${fpLoaded ? '✅' : '❌'}<br>
                ${i18nLoaded ? `• 当前语言: ${window.i18n.getCurrentLanguage()}<br>` : ''}
                ${i18nLoaded && fpLoaded ? '• 所有依赖已就绪 ✅' : '• 存在加载问题 ❌'}
            `;
            
            if (!i18nLoaded || !fpLoaded) {
                resultDiv.className = 'result error';
            }
        }
        
        function testTranslations() {
            const resultDiv = document.getElementById('translation-check');
            
            if (!window.i18n) {
                resultDiv.innerHTML = '<strong>错误:</strong> i18n对象不存在';
                resultDiv.className = 'result error';
                return;
            }
            
            try {
                // 测试中文
                window.i18n.switchLanguage('zh');
                const zhBtn = window.i18n.t('btn.view_details');
                const zhOverlay = window.i18n.t('btn.click_view_details');
                
                // 测试英文
                window.i18n.switchLanguage('en');
                const enBtn = window.i18n.t('btn.view_details');
                const enOverlay = window.i18n.t('btn.click_view_details');
                
                resultDiv.innerHTML = `
                    <strong>翻译测试结果:</strong><br>
                    • 中文 btn.view_details: "${zhBtn}"<br>
                    • 中文 btn.click_view_details: "${zhOverlay}"<br>
                    • 英文 btn.view_details: "${enBtn}"<br>
                    • 英文 btn.click_view_details: "${enOverlay}"<br>
                    ${enBtn === 'View Details' ? '• 英文翻译正确 ✅' : '• 英文翻译有问题 ❌'}
                `;
                
                // 恢复中文
                window.i18n.switchLanguage('zh');
                
            } catch (e) {
                resultDiv.innerHTML = `<strong>错误:</strong> ${e.message}`;
                resultDiv.className = 'result error';
            }
        }
        
        function testCardRender(lang) {
            const resultDiv = document.getElementById('card-test');
            
            if (!window.i18n || !window.FeaturedProducts) {
                resultDiv.innerHTML = '<strong>错误:</strong> 必要的对象不存在';
                resultDiv.className = 'result error';
                return;
            }
            
            try {
                // 切换语言
                window.i18n.switchLanguage(lang);
                
                // 创建测试产品
                const testProduct = {
                    id: 999,
                    name: '测试产品',
                    description: '这是一个测试产品',
                    price: 199.99,
                    image_url: 'https://via.placeholder.com/200x200?text=Test'
                };
                
                // 创建FeaturedProducts实例
                const fp = new window.FeaturedProducts();
                
                // 生成卡片HTML
                const cardHTML = fp.renderSingleProductCard(testProduct, 1);
                
                // 提取按钮文本
                const btnTextMatch = cardHTML.match(/<span class="btn-text">(.*?)<\/span>/);
                const btnText = btnTextMatch ? btnTextMatch[1] : '未找到';
                
                resultDiv.innerHTML = `
                    <strong>${lang === 'zh' ? '中文' : '英文'}卡片生成结果:</strong><br>
                    • 提取的按钮文本: "${btnText}"<br>
                    • 预期文本: "${lang === 'zh' ? '查看详情' : 'View Details'}"<br>
                    • 结果: ${btnText === (lang === 'zh' ? '查看详情' : 'View Details') ? '✅ 正确' : '❌ 错误'}<br>
                    <br>
                    <strong>完整卡片HTML:</strong><br>
                    <div style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 11px;">
                        ${cardHTML.replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                    </div>
                `;
                
            } catch (e) {
                resultDiv.innerHTML = `<strong>错误:</strong> ${e.message}<br><br><strong>详细信息:</strong><br>${e.stack}`;
                resultDiv.className = 'result error';
                console.error(e);
            }
        }
        
        // 页面加载完成后自动检查
        setTimeout(() => {
            checkScripts();
        }, 500);
    </script>
</body>
</html>