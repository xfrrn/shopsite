<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç»ˆæè°ƒè¯• - æŒ‰é’®æ–‡æœ¬é—®é¢˜</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-box { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .success { border-color: #28a745; background: #d4edda; }
        .info { border-color: #17a2b8; background: #d1ecf1; }
        button { margin: 5px; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-test { background: #007bff; color: white; }
        .product-preview { border: 2px solid #007bff; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .console-log { font-family: monospace; font-size: 12px; background: #2d3748; color: #e2e8f0; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ç‰¹è‰²äº§å“æŒ‰é’®æ–‡æœ¬ç»ˆæè°ƒè¯•</h1>
    
    <div class="debug-box info">
        <h3>ğŸ“‹ é—®é¢˜æè¿°</h3>
        <p>ç‰¹è‰²äº§å“å¡ç‰‡ä¸Šçš„"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®åœ¨åˆ‡æ¢ä¸ºè‹±æ–‡åä»æ˜¾ç¤ºä¸­æ–‡ï¼Œéœ€è¦æ‰¾å‡ºæ ¹æœ¬åŸå› ã€‚</p>
    </div>
    
    <div class="debug-box">
        <h3>ğŸ§ª æµ‹è¯•æ§åˆ¶</h3>
        <button class="btn-test" onclick="runFullDiagnosis()">ğŸš€ è¿è¡Œå®Œæ•´è¯Šæ–­</button>
        <button class="btn-test" onclick="testDirectCall()">ğŸ“ ç›´æ¥è°ƒç”¨æµ‹è¯•</button>
        <button class="btn-test" onclick="simulateLanguageSwitch()">ğŸ”„ æ¨¡æ‹Ÿè¯­è¨€åˆ‡æ¢</button>
    </div>
    
    <div id="diagnosis-results">
        <!-- è¯Šæ–­ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
    </div>
    
    <div class="debug-box">
        <h3>ğŸ–¼ï¸ å®é™…æ•ˆæœé¢„è§ˆ</h3>
        <div id="product-preview" class="product-preview">
            ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•
        </div>
    </div>
    
    <div class="debug-box">
        <h3>ğŸ“Š æ§åˆ¶å°è¾“å‡º</h3>
        <div id="console-logs" class="console-log">
            æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
        </div>
    </div>
    
    <!-- åŠ è½½å®é™…çš„è„šæœ¬æ–‡ä»¶ -->
    <script src="js/i18n.js?v=20250915"></script>
    <script src="js/featured-products.js?v=20250915-debug2"></script>
    
    <script>
        // æ‹¦æˆªæ‰€æœ‰consoleè¾“å‡º
        const logs = [];
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error
        };
        
        ['log', 'warn', 'error'].forEach(method => {
            console[method] = function(...args) {
                logs.push({
                    method,
                    time: new Date().toLocaleTimeString(),
                    args: args
                });
                updateConsoleLogs();
                originalConsole[method].apply(console, args);
            };
        });
        
        function updateConsoleLogs() {
            const consoleDiv = document.getElementById('console-logs');
            consoleDiv.innerHTML = logs.map(log => {
                const color = {
                    log: '#e2e8f0',
                    warn: '#fbbf24',
                    error: '#ef4444'
                }[log.method];
                
                return `<div style="color: ${color}; margin: 2px 0;">
                    [${log.time}] ${log.method.toUpperCase()}: ${log.args.join(' ')}
                </div>`;
            }).join('');
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function addResult(html, type = 'info') {
            const resultsDiv = document.getElementById('diagnosis-results');
            const classes = {
                info: 'debug-box info',
                error: 'debug-box error',
                success: 'debug-box success'
            };
            
            resultsDiv.innerHTML += `<div class="${classes[type]}">${html}</div>`;
        }
        
        function runFullDiagnosis() {
            console.log('ğŸ” å¼€å§‹å®Œæ•´è¯Šæ–­...');
            
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            document.getElementById('diagnosis-results').innerHTML = '';
            
            // æ£€æŸ¥1: åŸºç¡€ç»„ä»¶
            const i18nExists = !!window.i18n;
            const fpExists = !!window.FeaturedProducts;
            
            addResult(`
                <h3>âœ… ç¬¬1æ­¥: åŸºç¡€ç»„ä»¶æ£€æŸ¥</h3>
                <ul>
                    <li>window.i18n å­˜åœ¨: ${i18nExists ? 'âœ…' : 'âŒ'}</li>
                    <li>window.FeaturedProducts å­˜åœ¨: ${fpExists ? 'âœ…' : 'âŒ'}</li>
                </ul>
            `, i18nExists && fpExists ? 'success' : 'error');
            
            if (!i18nExists || !fpExists) {
                addResult('<h3>âŒ è¯Šæ–­ç»ˆæ­¢</h3><p>åŸºç¡€ç»„ä»¶ç¼ºå¤±ï¼Œæ— æ³•ç»§ç»­æµ‹è¯•ã€‚</p>', 'error');
                return;
            }
            
            // æ£€æŸ¥2: ç¿»è¯‘æ•°æ®
            const currentLang = window.i18n.getCurrentLanguage();
            const zhBtn = window.i18n.t('btn.view_details');
            
            // åˆ‡æ¢åˆ°è‹±æ–‡æµ‹è¯•
            window.i18n.switchLanguage('en');
            const enBtn = window.i18n.t('btn.view_details');
            
            // æ¢å¤åŸè¯­è¨€
            window.i18n.switchLanguage(currentLang);
            
            addResult(`
                <h3>âœ… ç¬¬2æ­¥: ç¿»è¯‘æ•°æ®æ£€æŸ¥</h3>
                <ul>
                    <li>å½“å‰è¯­è¨€: ${currentLang}</li>
                    <li>ä¸­æ–‡ç¿»è¯‘ 'btn.view_details': "${zhBtn}"</li>
                    <li>è‹±æ–‡ç¿»è¯‘ 'btn.view_details': "${enBtn}"</li>
                    <li>ç¿»è¯‘æ•°æ®å®Œæ•´æ€§: ${zhBtn && enBtn && zhBtn !== enBtn ? 'âœ…' : 'âŒ'}</li>
                </ul>
            `, zhBtn && enBtn && zhBtn !== enBtn ? 'success' : 'error');
            
            // æ£€æŸ¥3: æ¸²æŸ“åŠŸèƒ½
            setTimeout(() => {
                testRenderFunction();
            }, 100);
        }
        
        function testRenderFunction() {
            console.log('ğŸ§ª æµ‹è¯•æ¸²æŸ“åŠŸèƒ½...');
            
            try {
                const fp = new window.FeaturedProducts();
                const testProduct = {
                    id: 999,
                    name: 'æµ‹è¯•äº§å“',
                    description: 'æµ‹è¯•æè¿°',
                    price: 99.99,
                    image_url: 'https://via.placeholder.com/200x200?text=Test'
                };
                
                // æµ‹è¯•ä¸­æ–‡æ¸²æŸ“
                window.i18n.switchLanguage('zh');
                const zhHTML = fp.renderSingleProductCard(testProduct, 1);
                const zhBtnMatch = zhHTML.match(/<span class="btn-text">(.*?)<\/span>/);
                const zhBtnText = zhBtnMatch ? zhBtnMatch[1] : 'æœªæ‰¾åˆ°';
                
                // æµ‹è¯•è‹±æ–‡æ¸²æŸ“
                window.i18n.switchLanguage('en');
                const enHTML = fp.renderSingleProductCard(testProduct, 1);
                const enBtnMatch = enHTML.match(/<span class="btn-text">(.*?)<\/span>/);
                const enBtnText = enBtnMatch ? enBtnMatch[1] : 'æœªæ‰¾åˆ°';
                
                addResult(`
                    <h3>âœ… ç¬¬3æ­¥: æ¸²æŸ“åŠŸèƒ½æ£€æŸ¥</h3>
                    <ul>
                        <li>ä¸­æ–‡æ¸²æŸ“æŒ‰é’®æ–‡æœ¬: "${zhBtnText}"</li>
                        <li>è‹±æ–‡æ¸²æŸ“æŒ‰é’®æ–‡æœ¬: "${enBtnText}"</li>
                        <li>æ¸²æŸ“åŠŸèƒ½æ­£å¸¸: ${zhBtnText === 'æŸ¥çœ‹è¯¦æƒ…' && enBtnText === 'View Details' ? 'âœ…' : 'âŒ'}</li>
                    </ul>
                    <details>
                        <summary>æŸ¥çœ‹è¯¦ç»†HTML</summary>
                        <pre style="background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 10px;">ä¸­æ–‡HTML: ${zhHTML.substring(0, 200)}...</pre>
                        <pre style="background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 10px;">è‹±æ–‡HTML: ${enHTML.substring(0, 200)}...</pre>
                    </details>
                `, zhBtnText === 'æŸ¥çœ‹è¯¦æƒ…' && enBtnText === 'View Details' ? 'success' : 'error');
                
                // æ˜¾ç¤ºè‹±æ–‡ç‰ˆæœ¬çš„é¢„è§ˆ
                document.getElementById('product-preview').innerHTML = enHTML;
                
                // æ¢å¤ä¸­æ–‡
                window.i18n.switchLanguage('zh');
                
                // æœ€ç»ˆç»“è®º
                const allTestsPassed = (zhBtnText === 'æŸ¥çœ‹è¯¦æƒ…' && enBtnText === 'View Details');
                addResult(`
                    <h3>${allTestsPassed ? 'ğŸ‰ è¯Šæ–­ç»“è®º: åŠŸèƒ½æ­£å¸¸' : 'âš ï¸ è¯Šæ–­ç»“è®º: å­˜åœ¨é—®é¢˜'}</h3>
                    <p>${allTestsPassed ? 
                        'æŒ‰é’®æ–‡æœ¬å¤šè¯­è¨€åŠŸèƒ½è¿è¡Œæ­£å¸¸ã€‚å¦‚æœåœ¨å®é™…ç½‘é¡µä¸­ä»æ˜¾ç¤ºé—®é¢˜ï¼Œå¯èƒ½æ˜¯ç¼“å­˜é—®é¢˜ã€‚è¯·å°è¯•å¼ºåˆ¶åˆ·æ–° (Ctrl+F5) æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚' : 
                        'æŒ‰é’®æ–‡æœ¬å¤šè¯­è¨€åŠŸèƒ½å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥æ’æŸ¥ä»£ç é€»è¾‘ã€‚'
                    }</p>
                `, allTestsPassed ? 'success' : 'error');
                
            } catch (e) {
                addResult(`
                    <h3>âŒ æ¸²æŸ“æµ‹è¯•å¤±è´¥</h3>
                    <p>é”™è¯¯ä¿¡æ¯: ${e.message}</p>
                    <pre style="background: #f8f9fa; padding: 10px; font-size: 12px;">${e.stack}</pre>
                `, 'error');
            }
        }
        
        function testDirectCall() {
            console.log('ğŸ“ ç›´æ¥è°ƒç”¨æµ‹è¯•...');
            runFullDiagnosis();
        }
        
        function simulateLanguageSwitch() {
            console.log('ğŸ”„ æ¨¡æ‹Ÿè¯­è¨€åˆ‡æ¢...');
            
            if (!window.i18n) {
                addResult('<h3>âŒ è¯­è¨€åˆ‡æ¢å¤±è´¥</h3><p>i18nå¯¹è±¡ä¸å­˜åœ¨</p>', 'error');
                return;
            }
            
            const originalLang = window.i18n.getCurrentLanguage();
            const targetLang = originalLang === 'zh' ? 'en' : 'zh';
            
            addResult(`
                <h3>ğŸ”„ è¯­è¨€åˆ‡æ¢æµ‹è¯•</h3>
                <p>ä» ${originalLang} åˆ‡æ¢åˆ° ${targetLang}</p>
            `);
            
            // æ‰§è¡Œåˆ‡æ¢
            window.i18n.switchLanguage(targetLang).then(() => {
                console.log('è¯­è¨€åˆ‡æ¢å®Œæˆï¼Œé‡æ–°è¿è¡Œè¯Šæ–­...');
                setTimeout(runFullDiagnosis, 200);
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œè¯Šæ–­
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨è¯Šæ–­...');
                runFullDiagnosis();
            }, 1000);
        });
    </script>
</body>
</html>