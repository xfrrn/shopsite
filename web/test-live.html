<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å®æ—¶æŒ‰é’®æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            line-height: 1.6; 
        }
        .test-container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .control-panel { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
        }
        .result-panel { 
            background: white; 
            border: 1px solid #ddd; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
        }
        button { 
            margin: 5px; 
            padding: 8px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px; 
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .console-output { 
            background: #f8f9fa; 
            border: 1px solid #ddd; 
            padding: 10px; 
            border-radius: 4px; 
            font-family: monospace; 
            font-size: 12px; 
            max-height: 300px; 
            overflow-y: auto; 
        }
        .product-demo { 
            border: 1px solid #ddd; 
            padding: 15px; 
            border-radius: 8px; 
            background: white; 
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ç‰¹è‰²äº§å“æŒ‰é’®å®æ—¶æµ‹è¯•</h1>
        
        <div class="control-panel">
            <h3>æ§åˆ¶é¢æ¿</h3>
            <button class="btn-primary" onclick="loadScripts()">é‡æ–°åŠ è½½è„šæœ¬</button>
            <button class="btn-success" onclick="testChinese()">æµ‹è¯•ä¸­æ–‡</button>
            <button class="btn-success" onclick="testEnglish()">æµ‹è¯•è‹±æ–‡</button>
            <button class="btn-warning" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        </div>
        
        <div class="result-panel">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="test-results">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•</div>
        </div>
        
        <div class="result-panel">
            <h3>äº§å“å¡ç‰‡æ¼”ç¤º</h3>
            <div id="product-demo" class="product-demo">
                <!-- äº§å“å¡ç‰‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </div>
        
        <div class="result-panel">
            <h3>æ§åˆ¶å°è¾“å‡º</h3>
            <div id="console-output" class="console-output">
                <!-- æ§åˆ¶å°ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </div>
    </div>

    <script>
        // åŠ«æŒconsole.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalWarn = console.warn;
        const consoleOutput = [];
        
        console.log = function(...args) {
            consoleOutput.push(['LOG', new Date().toLocaleTimeString(), ...args]);
            updateConsoleDisplay();
            originalLog.apply(console, args);
        };
        
        console.warn = function(...args) {
            consoleOutput.push(['WARN', new Date().toLocaleTimeString(), ...args]);
            updateConsoleDisplay();
            originalWarn.apply(console, args);
        };
        
        function updateConsoleDisplay() {
            const output = document.getElementById('console-output');
            output.innerHTML = consoleOutput.map(entry => {
                const [type, time, ...msgs] = entry;
                const color = type === 'WARN' ? '#ff6b35' : '#333';
                return `<div style="color: ${color}; margin: 2px 0;">[${time}] ${msgs.join(' ')}</div>`;
            }).join('');
            output.scrollTop = output.scrollHeight;
        }
        
        function clearConsole() {
            consoleOutput.length = 0;
            updateConsoleDisplay();
        }
        
        function updateResults(html) {
            document.getElementById('test-results').innerHTML = html;
        }
        
        function loadScripts() {
            updateResults('æ­£åœ¨é‡æ–°åŠ è½½è„šæœ¬...');
            console.log('ğŸ”„ å¼€å§‹é‡æ–°åŠ è½½è„šæœ¬');
            
            // åˆ é™¤æ—§è„šæœ¬
            const oldScripts = document.querySelectorAll('script[data-test]');
            oldScripts.forEach(script => script.remove());
            
            // åŠ è½½æ–°è„šæœ¬
            const timestamp = Date.now();
            
            const i18nScript = document.createElement('script');
            i18nScript.src = `js/i18n.js?v=${timestamp}`;
            i18nScript.setAttribute('data-test', 'true');
            
            const fpScript = document.createElement('script');
            fpScript.src = `js/featured-products.js?v=${timestamp}`;
            fpScript.setAttribute('data-test', 'true');
            
            i18nScript.onload = () => {
                console.log('âœ… i18n.js åŠ è½½å®Œæˆ');
                document.head.appendChild(fpScript);
            };
            
            fpScript.onload = () => {
                console.log('âœ… featured-products.js åŠ è½½å®Œæˆ');
                updateResults('è„šæœ¬é‡æ–°åŠ è½½å®Œæˆï¼');
            };
            
            document.head.appendChild(i18nScript);
        }
        
        function testChinese() {
            console.log('ğŸ§ª å¼€å§‹ä¸­æ–‡æµ‹è¯•');
            runTest('zh');
        }
        
        function testEnglish() {
            console.log('ğŸ§ª å¼€å§‹è‹±æ–‡æµ‹è¯•');
            runTest('en');
        }
        
        function runTest(lang) {
            if (!window.i18n || !window.FeaturedProducts) {
                updateResults(`âŒ æµ‹è¯•å¤±è´¥: å¿…è¦ç»„ä»¶æœªåŠ è½½ (i18n: ${!!window.i18n}, FP: ${!!window.FeaturedProducts})`);
                return;
            }
            
            try {
                // åˆ‡æ¢è¯­è¨€
                console.log(`ğŸ”„ åˆ‡æ¢è¯­è¨€åˆ°: ${lang}`);
                window.i18n.switchLanguage(lang);
                
                // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿åˆ‡æ¢å®Œæˆ
                setTimeout(() => {
                    const currentLang = window.i18n.getCurrentLanguage();
                    const btnText = window.i18n.t('btn.view_details');
                    
                    console.log(`ğŸ“‹ å½“å‰è¯­è¨€: ${currentLang}`);
                    console.log(`ğŸ“‹ æŒ‰é’®æ–‡æœ¬: "${btnText}"`);
                    
                    // åˆ›å»ºæµ‹è¯•äº§å“
                    const testProduct = {
                        id: 888,
                        name: lang === 'zh' ? 'æµ‹è¯•äº§å“' : 'Test Product',
                        description: lang === 'zh' ? 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•äº§å“çš„æè¿°' : 'This is a test product description',
                        price: 299.99,
                        image_url: 'https://via.placeholder.com/200x200?text=Test'
                    };
                    
                    console.log(`ğŸ­ åˆ›å»º FeaturedProducts å®ä¾‹`);
                    const fp = new window.FeaturedProducts();
                    
                    console.log(`ğŸ¨ è°ƒç”¨ renderSingleProductCard`);
                    const cardHTML = fp.renderSingleProductCard(testProduct, 1);
                    
                    // æ˜¾ç¤ºäº§å“å¡ç‰‡
                    document.getElementById('product-demo').innerHTML = cardHTML;
                    
                    // æå–æŒ‰é’®æ–‡æœ¬è¿›è¡ŒéªŒè¯
                    const btnMatch = cardHTML.match(/<span class="btn-text">(.*?)<\/span>/);
                    const extractedBtnText = btnMatch ? btnMatch[1] : 'æœªæ‰¾åˆ°';
                    
                    const expected = lang === 'zh' ? 'æŸ¥çœ‹è¯¦æƒ…' : 'View Details';
                    const isCorrect = extractedBtnText === expected;
                    
                    updateResults(`
                        <div style="margin-bottom: 10px;">
                            <strong>æµ‹è¯•è¯­è¨€:</strong> ${lang === 'zh' ? 'ä¸­æ–‡' : 'è‹±æ–‡'}<br>
                            <strong>å½“å‰è¯­è¨€:</strong> ${currentLang}<br>
                            <strong>ç¿»è¯‘ç»“æœ:</strong> "${btnText}"<br>
                            <strong>æå–çš„æŒ‰é’®æ–‡æœ¬:</strong> "${extractedBtnText}"<br>
                            <strong>é¢„æœŸæ–‡æœ¬:</strong> "${expected}"<br>
                            <strong>æµ‹è¯•ç»“æœ:</strong> <span style="color: ${isCorrect ? 'green' : 'red'}; font-weight: bold;">
                                ${isCorrect ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}
                            </span>
                        </div>
                    `);
                    
                    console.log(`ğŸ“Š æµ‹è¯•ç»“æœ: ${isCorrect ? 'é€šè¿‡' : 'å¤±è´¥'}`);
                    
                }, 100);
                
            } catch (e) {
                updateResults(`âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${e.message}`);
                console.log(`âŒ æµ‹è¯•é”™è¯¯:`, e);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½è„šæœ¬
        window.addEventListener('load', () => {
            setTimeout(loadScripts, 500);
        });
    </script>
</body>
</html>