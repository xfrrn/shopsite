# 数据库更新指南

## 🗃️ 数据库完整更新流程

如果您的服务器数据库还是旧版本，没有最新的表结构，请按照以下顺序运行脚本：

### 1️⃣ 第一步：初始化基础数据库结构
```bash
python initialize_db.py
```
**作用**：
- 创建所有基础表（Admin, Category, Product等）
- 创建默认管理员账户
- 创建示例分类数据
- 创建示例产品数据

### 2️⃣ 第二步：添加"关于我们"功能
```bash
python migrate_about_us.py
```
**作用**：
- 创建 `about_us` 表
- 插入默认的"关于我们"内容
- 支持后台编辑关于我们部分

### 3️⃣ 第三步：添加顶部信息栏功能
```bash
python migrate_top_info_bar.py
```
**作用**：
- 创建 `top_info_bar` 表
- 插入默认的客服热线和社交媒体信息
- 支持后台编辑顶部信息栏

## 🚀 完整运行命令

在项目根目录下依次运行：

```bash
# 1. 初始化基础数据库
python initialize_db.py

# 2. 添加关于我们表
python migrate_about_us.py

# 3. 添加顶部信息栏表
python migrate_top_info_bar.py
```

## 📋 运行前检查清单

### 环境确认
- [ ] 确认Python环境已激活
- [ ] 确认数据库服务正在运行
- [ ] 确认 `config/settings.ini` 配置正确

### 数据库配置检查
检查 `config/settings.ini` 文件：
```ini
[database]
host = localhost
port = 3306
username = your_username
password = your_password
database = your_database_name
```

### 依赖包确认
```bash
pip install -r requirements.txt
```

## ✅ 运行成功标志

### initialize_db.py 成功输出：
```
🔧 开始初始化数据库...
✅ 数据库表创建完成
✅ 默认管理员创建成功
✅ 示例分类创建完成
✅ 示例产品创建完成
🎉 数据库初始化完成！
```

### migrate_about_us.py 成功输出：
```
✅ 关于我们表创建成功
✅ 默认关于我们数据插入成功
🎉 关于我们表迁移完成！
```

### migrate_top_info_bar.py 成功输出：
```
✅ 顶部信息栏表创建成功
✅ 默认顶部信息栏数据插入成功
🎉 顶部信息栏表迁移完成！
```

## 🔍 故障排除

### 如果初始化失败：
1. **检查数据库连接**：
   ```bash
   python test_db.py
   ```

2. **检查配置文件**：
   确认 `config/settings.ini` 中的数据库信息正确

3. **检查数据库权限**：
   确保数据库用户有创建表的权限

### 如果表已存在：
如果运行时提示表已存在，这是正常的。脚本会自动跳过已存在的表。

### 数据冲突处理：
- 脚本会检查是否已有数据
- 如果有数据，不会重复插入
- 如果需要重置数据，请手动删除对应记录

## 📊 数据库表结构预览

运行完成后，您的数据库将包含以下表：

### 基础表（initialize_db.py）
- `admins` - 管理员账户
- `categories` - 产品分类
- `products` - 产品信息
- `background_images` - 背景图片
- `featured_products` - 特色产品

### 新增表（迁移脚本）
- `about_us` - 关于我们内容
- `top_info_bar` - 顶部信息栏内容

## 🎯 更新完成后

### 验证步骤：
1. **启动服务器**：
   ```bash
   python main.py
   ```

2. **访问管理后台**：
   - 地址: `http://localhost:8000/admin.html`
   - 默认账号: `admin`
   - 默认密码: `admin123`

3. **检查新功能**：
   - 关于我们编辑功能
   - 顶部信息栏编辑功能
   - 前端显示效果

### 安全建议：
- 立即修改默认管理员密码
- 根据需要调整管理员权限
- 定期备份数据库

## 🆘 需要帮助？

如果在运行过程中遇到问题：
1. 检查控制台错误信息
2. 查看数据库日志
3. 确认网络和权限设置
4. 可以先运行 `python test_db.py` 测试数据库连接

---

**重要提示**：请在生产环境运行前，先在测试环境验证所有脚本的执行效果。